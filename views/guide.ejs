<%- include('partials/header', {
  pageTitle: 'Alchemy Integration User Guide',
  activePage: 'guide',
  showStatus: false
}) %>

<section class="guide-section">
  <h1>📘 Alchemy Integration – User Guide</h1>

  <h2>1. 🔐 Setup</h2>
  <ul>
    <li>Go to the <a href="/admin">Admin page</a></li>
    <li>Enter your Alchemy Email, Password, Tenant, and Material Type ID</li>
    <li>Click <strong>Save Configuration</strong></li>
    <li>Click <strong>Test Connection</strong> to ensure credentials are valid</li>
    <li>Optional: Use <strong>Clear Token</strong> to force re-authentication, or <strong>Clear All Credentials</strong> to reset everything</li>
  </ul>

  <h2>2. 🧪 Transferring Materials (ERP → Alchemy)</h2>
  <ul>
    <li>Visit the <a href="/">Materials page</a> to view mock materials</li>
    <li>Click <strong>Transfer</strong> next to a material</li>
    <li>The app will create a material in Alchemy and read back its Code</li>
    <li>After success, the Code and link to the record will be updated</li>
  </ul>

  <h2>3. 📦 Receiving Products (Alchemy → ERP)</h2>
  <ul>
    <li>Visit the <a href="/products">Products page</a> to view received products</li>
    <li>Products are sent FROM Alchemy TO this system via API</li>
    <li>Use this endpoint from Alchemy: <code>POST http://[your-host]/api/products/receive</code></li>
    <li>Required fields: Code, ProductName, RecordID</li>
    <li>Optional fields: Family, Subfamily, SKU, CreatedOn, ProductStatus</li>
    <li>Each product includes a link back to its Alchemy record</li>
  </ul>

  <h2>4. ↩️ Reverting & 🗑️ Deleting</h2>
  <ul>
    <li>For Materials: Use <strong>Revert</strong> to reset a transferred material back to <em>Pending</em></li>
    <li>For both Materials and Products: Use <strong>Delete</strong> to remove from the local list</li>
  </ul>

  <h2>5. 🛠️ Troubleshooting</h2>
  <ul>
    <li><strong>Code shows as "-1.0":</strong> Alchemy may not have finished indexing. Try again after 2 seconds.</li>
    <li><strong>403 / 401 Errors:</strong> Recheck your credentials and tenant name</li>
    <li><strong>500 Errors:</strong> See browser console and logs in terminal for exact cause</li>
    <li><strong>Products not appearing:</strong> Ensure the API call includes all required fields (Code, ProductName, RecordID)</li>
  </ul>

  <h2>6. 🔍 Field Mapping Reference</h2>
  <h3>Materials (ERP → Alchemy):</h3>
  <ul>
    <li>Mapped fields: <code>TradeName</code>, <code>Category</code>, <code>MaterialStatus</code>, <code>ProducedBy</code>, <code>ExternalCode</code></li>
  </ul>
  
  <h3>Products (Alchemy → ERP):</h3>
  <ul>
    <li>Required: <code>Code</code>, <code>ProductName</code>, <code>RecordID</code></li>
    <li>Optional: <code>Family</code>, <code>Subfamily</code>, <code>SKU</code>, <code>CreatedOn</code>, <code>ProductStatus</code></li>
  </ul>

  <h2>7. 📡 API Example for Products</h2>
  <div style="background: var(--light-bg); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
    <pre style="margin: 0;">curl -X POST http://localhost:3000/api/products/receive \
  -H "Content-Type: application/json" \
  -d '{
    "Code": "PROD-001",
    "ProductName": "Sample Product",
    "Family": "Chemicals",
    "Subfamily": "Organic",
    "SKU": "SKU-12345",
    "CreatedOn": "2024-01-20T10:00:00Z",
    "ProductStatus": "Active",
    "RecordID": "abc123"
  }'</pre>
  </div>
</section>

<%- include('partials/footer', {
  connectionStatus: config?.email ? 'Configured' : 'Not Configured'
}) %>
